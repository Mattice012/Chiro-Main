<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chiro Jaarkalender</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        chiro: {
                            red: '#db2721', 
                            blue: '#2563eb',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.2s ease-out',
                        'slide-up': 'slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pop': 'pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(10px) scale(0.98)' }, '100%': { opacity: '1', transform: 'translateY(0) scale(1)' } },
                        pop: { '0%': { transform: 'scale(0.9)' }, '100%': { transform: 'scale(1)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* Sticky header met backdrop blur voor modern effect */
        .sticky-header { position: sticky; top: 0; z-index: 40; transition: all 0.3s ease; backdrop-filter: blur(8px); background-color: rgba(255, 255, 255, 0.9); }
        .dark .sticky-header { background-color: rgba(31, 41, 55, 0.9); }
        
        /* Custom Scrollbar */
        .day-cell::-webkit-scrollbar { width: 2px; }
        .day-cell::-webkit-scrollbar-track { background: transparent; }
        .day-cell::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
        
        /* Event Pill Styling */
        .event-pill {
            padding: 1px 3px;
            border-radius: 4px; font-size: 0.6rem;
            font-weight: 600;
            margin-bottom: 2px;
            display: flex; flex-direction: column; justify-content: center; gap: 0px; cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); border-left: 2px solid rgba(0,0,0,0.1);
            min-height: 18px;
            line-height: 1.1;
        }
        @media (min-width: 640px) {
            .event-pill { padding: 5px 6px; font-size: 0.7rem; margin-bottom: 4px; gap: 2px; min-height: 26px; border-radius: 6px; border-left-width: 3px; }
        }
        .event-pill:active { transform: scale(0.98); }

        /* Types Colors */
        .type-chirozondag { background: #fef2f2; color: #991b1b; border-left-color: #dc2626; } 
        .type-lk { background: #eff6ff; color: #1e40af; border-left-color: #2563eb; }
        .type-activiteit { background: #f0fdf4; color: #166534; border-left-color: #16a34a; }
        .type-vergadering { background: #fffbeb; color: #92400e; border-left-color: #d97706; }
        .type-weekend { background: #faf5ff; color: #6b21a8; border-left-color: #9333ea; }
    </style>
</head>
<body class="min-h-screen pb-20 sm:pb-8 text-gray-800 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-200 flex flex-col selection:bg-blue-100 selection:text-blue-900">

    <div id="toastContainer" class="fixed top-20 right-4 left-4 sm:left-auto sm:right-6 z-[100] flex flex-col gap-3 pointer-events-none"></div>

    <header class="sticky-header border-b border-gray-200 dark:border-gray-700 px-3 py-2 sm:px-8 shadow-sm">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 sm:gap-3 cursor-pointer group" onclick="location.reload()">
                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-chiro-blue rounded-full flex items-center justify-center text-white shadow-lg group-hover:scale-105 transition-transform">
                    <i data-lucide="calendar-days" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                </div>
                <div>
                    <h1 class="text-lg sm:text-xl font-extrabold text-gray-900 dark:text-white leading-tight">Chiro Kalender</h1>
                    <p class="text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-medium hidden sm:block">Planning & Events</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2 sm:gap-3">
                <a href="/" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-500 dark:text-gray-400" title="Terug naar Home">
                    <i data-lucide="home" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                </a>

                <div id="userInfo" class="hidden flex-col items-end mr-1 sm:mr-2 text-right animate-fade-in">
                    <span class="text-[10px] text-gray-400 uppercase tracking-widest font-bold hidden sm:block">Ingelogd</span>
                    <span id="userEmail" class="text-[10px] sm:text-xs font-semibold text-gray-700 dark:text-gray-300 truncate max-w-[80px] sm:max-w-[120px]"></span>
                </div>

                <button id="bulkBtn" onclick="openBulkModal()" class="hidden px-2 sm:px-4 py-1.5 sm:py-2 bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 rounded-lg font-semibold text-xs sm:text-sm shadow-sm transition-all items-center gap-2" title="Meerdere datums toevoegen">
                    <i data-lucide="layers" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">Reeks</span>
                </button>

                <button onclick="handleNavbarAction()" class="px-3 sm:px-4 py-1.5 sm:py-2 bg-chiro-blue hover:bg-blue-700 text-white rounded-lg font-semibold text-xs sm:text-sm shadow-md transition-all flex items-center gap-1.5 sm:gap-2 active:scale-95">
                    <i data-lucide="plus" class="w-3 h-3 sm:w-4 sm:h-4"></i> 
                    <span class="hidden sm:inline">Activiteit</span>
                    <span class="sm:hidden">Nieuw</span>
                </button>
                
                <button id="logoutBtn" onclick="handleLogout()" class="hidden p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-500 dark:text-gray-400" title="Uitloggen">
                    <i data-lucide="log-out" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full max-w-6xl mx-auto px-2 sm:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6">
        
        <div class="bg-white dark:bg-gray-800 p-2 sm:p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row justify-between items-center gap-2 sm:gap-4">
            <div class="flex items-center gap-2 sm:gap-3 bg-gray-50 dark:bg-gray-700/50 p-1 sm:p-1.5 rounded-xl border border-gray-200 dark:border-gray-600 w-full md:w-auto shadow-inner justify-between sm:justify-start">
                <button onclick="changeMonth(-1)" class="w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 hover:bg-white dark:hover:bg-gray-600 rounded-lg transition-all shadow-sm hover:shadow">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                </button>
                <div class="flex items-center gap-2 px-2 flex-1 justify-center">
                    <h2 id="currentMonthYear" class="text-base sm:text-lg font-bold text-gray-800 dark:text-white text-center capitalize min-w-[120px]">Laden...</h2>
                </div>
                <button onclick="changeMonth(1)" class="w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center text-gray-500 hover:text-blue-600 hover:bg-white dark:hover:bg-gray-600 rounded-lg transition-all shadow-sm hover:shadow">
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
                <button onclick="goToToday()" class="ml-1 text-[10px] font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 border border-blue-100 px-2 sm:px-3 py-1.5 rounded-md uppercase tracking-wider transition-colors h-8 sm:h-9">
                    Vandaag
                </button>
            </div>

            <div class="flex flex-wrap justify-center gap-2 sm:gap-3 px-1 sm:px-2 text-[10px] sm:text-xs font-medium text-gray-600 dark:text-gray-400">
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500 ring-2 ring-red-100"></span> Chiro</div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-600 ring-2 ring-blue-100"></span> Leiding</div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500 ring-2 ring-green-100"></span> Activiteit</div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-amber-500 ring-2 ring-amber-100"></span> Vergad.</div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-purple-600 ring-2 ring-purple-100"></span> Weekend</div>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
            <div class="grid grid-cols-7 bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600">
                <div class="py-2 sm:py-4 text-center text-[8px] sm:text-[10px] font-bold text-gray-400 uppercase tracking-widest">Ma</div>
                <div class="py-2 sm:py-4 text-center text-[8px] sm:text-[10px] font-bold text-gray-400 uppercase tracking-widest">Di</div>
                <div class="py-2 sm:py-4 text-center text-[8px] sm:text-[10px] font-bold text-gray-400 uppercase tracking-widest">Wo</div>
                <div class="py-2 sm:py-4 text-center text-[8px] sm:text-[10px] font-bold text-gray-400 uppercase tracking-widest">Do</div>
                <div class="py-2 sm:py-4 text-center text-[8px] sm:text-[10px] font-bold text-gray-400 uppercase tracking-widest">Vr</div>
                <div class="py-2 sm:py-4 text-center text-[8px] sm:text-[10px] font-bold text-gray-400 uppercase tracking-widest">Za</div>
                <div class="py-2 sm:py-4 text-center text-[8px] sm:text-[10px] font-bold text-red-400 uppercase tracking-widest">Zo</div>
            </div>
            <div id="calendarGrid" class="grid grid-cols-7 auto-rows-fr bg-white dark:bg-gray-800 min-h-[450px] sm:min-h-[600px] divide-x divide-gray-100 dark:divide-gray-700 divide-y">
                <div class="col-span-7 py-32 flex flex-col items-center justify-center text-gray-400 gap-3">
                    <i data-lucide="loader-2" class="w-8 h-8 animate-spin text-blue-600"></i>
                    <span class="text-sm font-medium tracking-wide">Kalender ophalen...</span>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-auto py-6 sm:py-8 text-center border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 mb-0">
        <p class="text-xs text-gray-400 font-medium">&copy; <span id="yearCopy"></span> Chiro Kalender Applicatie</p>
    </footer>

    <div id="addModal" class="fixed inset-0 bg-black/50 z-[70] hidden items-end sm:items-center justify-center p-0 sm:p-4 backdrop-blur-sm transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden animate-slide-up max-h-[90vh] overflow-y-auto">
            <div class="p-4 sm:p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50 sticky top-0 z-10">
                <div>
                    <h3 id="modalTitle" class="font-bold text-gray-800 dark:text-white text-lg sm:text-xl">Nieuwe Activiteit</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Vul de details in</p>
                </div>
                <button onclick="closeAddModal()" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition text-gray-500">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form id="addEventForm" class="p-4 sm:p-6 space-y-4 sm:space-y-5">
                <input type="hidden" id="evtId">
                
                <div class="space-y-1.5">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Categorie</label>
                    <div class="relative">
                        <select id="evtType" required class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none appearance-none text-sm">
                            <option value="chirozondag">游댮 Chirozondag (14u-18u)</option>
                            <option value="lk">游댯 Leidingskring (LK)</option>
                            <option value="activiteit">游릭 Speciale Activiteit</option>
                            <option value="vergadering">游리 Vergadering</option>
                            <option value="weekend">游릮 Weekend / Kamp</option>
                        </select>
                        <i data-lucide="chevron-down" class="w-4 h-4 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <div id="titleContainer" class="space-y-1.5">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Titel</label>
                    <input type="text" id="evtTitle" required placeholder="bv. Christus Koning" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none text-sm">
                </div>
                
                <div class="grid grid-cols-2 gap-4 sm:gap-5">
                    <div class="space-y-1.5">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Startdatum</label>
                        <input type="date" id="evtStart" required class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none text-sm">
                    </div>
                    <div id="endContainer" class="hidden space-y-1.5">
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Einddatum</label>
                        <input type="date" id="evtEnd" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none text-sm">
                    </div>
                </div>
                <div class="space-y-1.5">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Details</label>
                    <textarea id="evtDesc" rows="3" placeholder="Locatie, benodigdheden..." class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none resize-none text-sm"></textarea>
                </div>
                <button type="submit" id="submitBtn" class="w-full bg-chiro-blue hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-xl active:scale-[0.98] transition flex justify-center items-center gap-2 mt-2 text-sm sm:text-base">
                    <span>Opslaan</span> <i data-lucide="save" class="w-4 h-4"></i>
                </button>
                <div class="h-4 sm:hidden"></div>
            </form>
        </div>
    </div>

    <div id="bulkModal" class="fixed inset-0 bg-black/50 z-[70] hidden items-end sm:items-center justify-center p-0 sm:p-4 backdrop-blur-sm transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden animate-slide-up max-h-[90vh] overflow-y-auto">
            <div class="p-4 sm:p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50 sticky top-0 z-10">
                <div>
                    <h3 class="font-bold text-gray-800 dark:text-white text-lg sm:text-xl">Reeks Toevoegen</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Meerdere datums tegelijk</p>
                </div>
                <button onclick="closeBulkModal()" class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition text-gray-500">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form id="bulkEventForm" class="p-4 sm:p-6 space-y-4 sm:space-y-5">
                <div class="space-y-1.5">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Categorie</label>
                    <div class="relative">
                        <select id="bulkType" required onchange="handleBulkTypeChange(this.value)" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none appearance-none text-sm">
                            <option value="chirozondag">游댮 Chirozondag (14u-18u)</option>
                            <option value="lk">游댯 Leidingskring (LK)</option>
                            <option value="activiteit">游릭 Speciale Activiteit</option>
                            <option value="vergadering">游리 Vergadering</option>
                        </select>
                        <i data-lucide="chevron-down" class="w-4 h-4 absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <div id="bulkTitleContainer" class="hidden space-y-1.5">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Titel</label>
                    <input type="text" id="bulkTitle" placeholder="bv. Christus Koning" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none text-sm">
                </div>

                <div class="space-y-1.5">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Datums</label>
                    <p class="text-[10px] text-gray-500 mb-1">Formaat: <strong>DD/MM/YYYY</strong>, gescheiden door komma's.</p>
                    <textarea id="bulkDates" required rows="4" placeholder="10/11/2025&#10;17/11/2025" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none font-mono text-sm"></textarea>
                </div>

                <div class="space-y-1.5">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-gray-300">Details</label>
                    <textarea id="bulkDesc" rows="2" placeholder="Optioneel..." class="w-full px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none resize-none text-sm"></textarea>
                </div>

                <button type="submit" id="bulkSubmitBtn" class="w-full bg-chiro-blue hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-xl active:scale-[0.98] transition flex justify-center items-center gap-2 mt-2 text-sm sm:text-base">
                    <span>Toevoegen</span> <i data-lucide="layers" class="w-4 h-4"></i>
                </button>
                <div class="h-4 sm:hidden"></div>
            </form>
        </div>
    </div>

    <div id="viewModal" class="fixed inset-0 bg-black/50 z-[70] hidden items-end sm:items-center justify-center p-0 sm:p-4 backdrop-blur-sm transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl w-full max-w-md shadow-2xl overflow-hidden animate-slide-up max-h-[90vh] overflow-y-auto">
            <div class="p-6 relative">
                <button onclick="closeViewModal()" class="absolute top-4 right-4 z-20 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 transition">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
                <div class="flex items-start gap-4 sm:gap-5 mb-6">
                    <div id="viewIcon" class="w-12 h-12 sm:w-14 sm:h-14 rounded-2xl flex items-center justify-center text-xl sm:text-2xl shadow-md shrink-0 bg-blue-50 text-blue-600"></div>
                    <div class="pt-1">
                        <span id="viewType" class="inline-flex items-center px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider bg-gray-100 text-gray-500 mb-2"></span>
                        <h3 id="viewTitle" class="text-lg sm:text-2xl font-bold text-gray-900 dark:text-white leading-tight"></h3>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center gap-4 bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl border border-gray-100 dark:border-gray-600">
                        <div class="w-10 h-10 rounded-full bg-white dark:bg-gray-600 flex items-center justify-center text-gray-400 shadow-sm shrink-0">
                            <i data-lucide="calendar" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <p id="viewDate" class="text-sm font-bold text-gray-800 dark:text-white"></p>
                            <p id="viewDuration" class="text-xs text-gray-500 dark:text-gray-400 font-medium"></p>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-xl border border-gray-100 dark:border-gray-600 min-h-[80px]">
                        <h4 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                            <i data-lucide="align-left" class="w-3 h-3"></i> Omschrijving
                        </h4>
                        <p id="viewDesc" class="text-sm text-gray-600 dark:text-gray-300 whitespace-pre-line leading-relaxed"></p>
                    </div>
                </div>
                <div id="viewAdminActions" class="mt-8 pt-6 border-t border-gray-100 dark:border-gray-700 grid grid-cols-2 gap-4">
                    <button id="viewEditBtn" class="flex items-center justify-center gap-2 py-3 rounded-xl bg-white border border-gray-300 text-gray-600 font-bold text-sm hover:bg-gray-50 hover:text-blue-600 hover:border-blue-200 transition shadow-sm">
                        <i data-lucide="pencil" class="w-4 h-4"></i> Bewerken
                    </button>
                    <button id="viewDeleteBtn" class="flex items-center justify-center gap-2 py-3 rounded-xl bg-white border border-red-100 text-red-500 font-bold text-sm hover:bg-red-50 hover:border-red-200 transition shadow-sm">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> Verwijderen
                    </button>
                </div>
                <div class="h-6 sm:hidden"></div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="fixed inset-0 bg-black/50 z-[80] hidden items-center justify-center p-4 backdrop-blur-sm transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-2xl w-full max-w-[360px] shadow-2xl overflow-hidden animate-slide-up relative">
            <button onclick="closeLoginModal()" class="absolute top-4 right-4 z-20 text-gray-400 hover:text-gray-600 transition">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <div class="p-8 text-center">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600">
                    <i data-lucide="shield-check" class="w-8 h-8"></i>
                </div>
                <h3 class="font-bold text-gray-900 dark:text-white text-xl mb-2">Leiding Login</h3>
                <p class="text-gray-500 dark:text-gray-400 text-sm mb-6">Beveiligde toegang voor leiding</p>
                <form id="loginForm" class="space-y-4 text-left">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Emailadres</label>
                        <div class="relative">
                            <input type="email" id="loginEmail" required class="w-full pl-10 pr-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none text-sm">
                            <i data-lucide="mail" class="w-4 h-4 absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Wachtwoord</label>
                        <div class="relative">
                            <input type="password" id="loginPass" required class="w-full pl-10 pr-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition outline-none text-sm">
                            <i data-lucide="lock" class="w-4 h-4 absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    <div id="loginError" class="text-red-500 text-xs bg-red-50 p-3 rounded-lg border border-red-100 hidden flex items-start gap-2">
                        <i data-lucide="alert-circle" class="w-4 h-4 mt-0.5"></i> <span>Verkeerde gegevens.</span>
                    </div>
                    <button type="submit" class="w-full bg-chiro-blue hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl active:scale-[0.98] transition-all duration-200 mt-2 flex justify-center items-center gap-2 text-sm">
                        <span id="loginBtnText">Inloggen</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="fixed inset-0 bg-black/50 z-[90] hidden items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-gray-800 rounded-2xl w-full max-w-sm shadow-2xl animate-pop p-6 text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600">
                <i data-lucide="alert-triangle" class="w-8 h-8"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Ben je zeker?</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Dit verwijdert de activiteit definitief.</p>
            <div class="grid grid-cols-2 gap-3">
                <button id="cancelDelete" class="py-2.5 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold transition">Annuleren</button>
                <button id="confirmDelete" class="py-2.5 rounded-xl bg-red-600 hover:bg-red-700 text-white font-semibold transition flex justify-center items-center gap-2">
                    <span>Verwijderen</span>
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, deleteDoc, doc, updateDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // NIEUWE CONFIGURATIE VOOR CHIRO-AANWEZIGHEDEN-2C507
        const firebaseConfig = {
            apiKey: "AIzaSyARowFAsAFzH3MLNishFGhDvoN8f0dZx2g",
            authDomain: "chiro-aanwezigheden-2c507.firebaseapp.com",
            projectId: "chiro-aanwezigheden-2c507",
            storageBucket: "chiro-aanwezigheden-2c507.firebasestorage.app",
            messagingSenderId: "800439663397",
            appId: "1:800439663397:web:3225dc6704320c4227f8cc",
            measurementId: "G-36V4EYGV3P"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // We behouden dezelfde interne structuur
        const APP_ID = "chiro-kalender-prod"; 
        
        // EXPOSE DB FOR MIGRATION
        window.dbInstance = db;
        window.collectionInstance = collection;
        window.addDocInstance = addDoc;
        window.appIdInstance = APP_ID;
        
        let currentDate = new Date();
        let events = [];
        let currentUser = null;
        let logoutTimer = null;
        let pendingDate = null; 
        let pendingEditEvent = null;
        let deleteTargetId = null; 

        document.getElementById('yearCopy').innerText = new Date().getFullYear();

        window.showToast = (message, type = 'success') => {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            let iconName = type === 'error' ? 'alert-circle' : (type === 'info' ? 'info' : 'check-circle-2');
            let colorClass = type === 'error' ? 'border-red-500 text-red-700' : (type === 'info' ? 'border-blue-500 text-blue-700' : 'border-green-500 text-green-700');
            
            toast.className = `flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg shadow-gray-200 border-l-4 ${colorClass} bg-white pointer-events-auto transform translate-x-full opacity-0 transition-all duration-300 min-w-[280px] z-[100]`;
            toast.innerHTML = `
                <i data-lucide="${iconName}" class="w-5 h-5 shrink-0"></i>
                <span class="text-sm font-semibold text-gray-700">${message}</span>
            `;
            container.appendChild(toast);
            lucide.createIcons();
            requestAnimationFrame(() => toast.classList.remove('translate-x-full', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-x-10', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        };

        // --- AUTH ---
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            const userInfo = document.getElementById('userInfo');
            const logoutBtn = document.getElementById('logoutBtn');
            const bulkBtn = document.getElementById('bulkBtn');
            const userEmailSpan = document.getElementById('userEmail');

            if (logoutTimer) clearTimeout(logoutTimer);

            if (user && !user.isAnonymous) {
                userInfo.classList.remove('hidden'); userInfo.classList.add('flex');
                logoutBtn.classList.remove('hidden');
                bulkBtn.classList.remove('hidden');
                userEmailSpan.innerText = user.email;

                logoutTimer = setTimeout(() => {
                    showToast("Automatisch uitgelogd (inactiviteit)", "info");
                    signOut(auth);
                }, 5 * 60 * 1000); 

                if (pendingDate) { openAddModal(pendingDate); pendingDate = null; showToast("Datum geselecteerd"); }
                else if (pendingEditEvent) { openEditModal(pendingEditEvent); pendingEditEvent = null; showToast("Bewerk modus geopend"); }

            } else {
                userInfo.classList.add('hidden'); userInfo.classList.remove('flex');
                logoutBtn.classList.add('hidden');
                bulkBtn.classList.add('hidden');
                if (!user) signInAnonymously(auth).catch(console.error);
            }
            renderCalendar();
        });

        window.handleNavbarAction = () => {
            if (currentUser && !currentUser.isAnonymous) openAddModal();
            else openLoginModal();
        };

        window.handleDateClick = (dateStr) => {
            if (currentUser && !currentUser.isAnonymous) openAddModal(dateStr);
            else {
                pendingDate = dateStr;
                openLoginModal();
                showToast("Log in om te bewerken", "info");
            }
        }

        window.handleEditClick = (evt) => {
             if (currentUser && !currentUser.isAnonymous) {
                closeViewModal();
                openEditModal(evt);
            } else {
                pendingEditEvent = evt;
                closeViewModal();
                openLoginModal();
                showToast("Log in om te bewerken", "info");
            }
        }

        // Custom Confirm Logic
        window.handleDeleteClick = (evt) => {
             if (currentUser && !currentUser.isAnonymous) {
                deleteTargetId = evt.id;
                document.getElementById('confirmModal').classList.remove('hidden');
                document.getElementById('confirmModal').classList.add('flex');
            } else {
                showToast("Log in om te verwijderen", "error");
                openLoginModal();
            }
        }

        document.getElementById('cancelDelete').onclick = () => {
            document.getElementById('confirmModal').classList.add('hidden');
            document.getElementById('confirmModal').classList.remove('flex');
            deleteTargetId = null;
        };

        document.getElementById('confirmDelete').onclick = async () => {
            if(deleteTargetId) {
                const btn = document.getElementById('confirmDelete');
                const original = btn.innerHTML;
                btn.disabled = true;
                btn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Bezig...';
                lucide.createIcons();
                
                await deleteEvent(deleteTargetId);
                
                btn.disabled = false;
                btn.innerHTML = original;
                document.getElementById('confirmModal').classList.add('hidden');
                document.getElementById('confirmModal').classList.remove('flex');
                closeViewModal();
                deleteTargetId = null;
            }
        };

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const btnText = document.getElementById('loginBtnText');
            const originalText = btnText.innerText;
            
            btn.disabled = true;
            btnText.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin inline mr-1"></i> Laden...';
            lucide.createIcons();
            document.getElementById('loginError').classList.add('hidden');

            try {
                await signInWithEmailAndPassword(auth, document.getElementById('loginEmail').value, document.getElementById('loginPass').value);
                closeLoginModal();
                document.getElementById('loginForm').reset();
                showToast("Welkom terug!");
            } catch (error) {
                document.getElementById('loginError').classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btnText.innerText = originalText;
            }
        });

        window.handleLogout = () => {
            signOut(auth);
            showToast("Je bent succesvol uitgelogd", "info");
        };

        const loadEvents = () => {
            const q = query(collection(db, 'artifacts', APP_ID, 'public', 'data', 'events'));
            onSnapshot(q, (snapshot) => {
                events = [];
                snapshot.forEach(doc => events.push({ id: doc.id, ...doc.data() }));
                renderCalendar();
            });
        };

        document.getElementById('addEventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser || currentUser.isAnonymous) {
                showToast("Sessie verlopen. Log opnieuw in.", "error"); return;
            }

            const btn = document.getElementById('submitBtn');
            const originalContent = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>';
            lucide.createIcons();

            const eventId = document.getElementById('evtId').value;
            const type = document.getElementById('evtType').value;
            const start = document.getElementById('evtStart').value;
            let end = document.getElementById('evtEnd').value;
            const desc = document.getElementById('evtDesc').value;
            
            let title = document.getElementById('evtTitle').value;
            if(type === 'chirozondag' && (!title || title === 'Chirozondag')) title = "Chirozondag";

            if (type !== 'weekend' || !end) end = start;

            try {
                const data = { title, type, start, end, description: desc, updatedAt: new Date().toISOString() };
                if (eventId) {
                    await updateDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'events', eventId), data);
                    showToast("Activiteit bijgewerkt");
                } else {
                    data.createdBy = currentUser.uid;
                    data.createdAt = new Date().toISOString();
                    await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'events'), data);
                    showToast("Activiteit toegevoegd");
                }
                closeAddModal();
            } catch (error) {
                showToast("Fout: " + error.message, "error");
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        });

        // --- BULK FUNCTIE ---
        window.openBulkModal = () => {
            document.getElementById('bulkType').value = 'chirozondag';
            document.getElementById('bulkDates').value = '';
            document.getElementById('bulkDesc').value = '';
            handleBulkTypeChange('chirozondag');
            toggleModal('bulkModal', true);
        }

        window.closeBulkModal = () => toggleModal('bulkModal', false);

        window.handleBulkTypeChange = (val) => {
            const titleContainer = document.getElementById('bulkTitleContainer');
            if(val === 'chirozondag') titleContainer.classList.add('hidden');
            else titleContainer.classList.remove('hidden');
        }

        document.getElementById('bulkEventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser || currentUser.isAnonymous) return showToast("Log in aub.", "error");

            const btn = document.getElementById('bulkSubmitBtn');
            const original = btn.innerHTML;
            btn.disabled = true; btn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Bezig...';
            lucide.createIcons();

            const type = document.getElementById('bulkType').value;
            let title = document.getElementById('bulkTitle').value;
            if(type === 'chirozondag') title = "Chirozondag";
            if(!title) title = "Activiteit"; // fallback

            const desc = document.getElementById('bulkDesc').value;
            const datesText = document.getElementById('bulkDates').value;
            
            // Parse dates (split by newline or comma)
            const rawDates = datesText.split(/[\n,]+/).map(s => s.trim()).filter(s => s.length > 0);
            let successCount = 0;

            try {
                const batch = [];
                for(const dateStr of rawDates) {
                    // Try parse DD/MM/YYYY
                    const parts = dateStr.split(/[\/\-\.]/);
                    if(parts.length === 3) {
                        let d = parts[0].padStart(2,'0');
                        let m = parts[1].padStart(2,'0');
                        let y = parts[2];
                        if(y.length === 2) y = "20"+y;
                        
                        const isoDate = `${y}-${m}-${d}`;
                        // Basic validation
                        if(!isNaN(new Date(isoDate).getTime())) {
                            await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'events'), {
                                title, type, start: isoDate, end: isoDate, description: desc,
                                createdBy: currentUser.uid, createdAt: new Date().toISOString()
                            });
                            successCount++;
                        }
                    }
                }
                if(successCount > 0) showToast(`${successCount} activiteiten toegevoegd!`);
                else showToast("Geen geldige datums gevonden.", "error");
                closeBulkModal();
            } catch(err) {
                showToast("Fout: " + err.message, "error");
            } finally {
                btn.disabled = false; btn.innerHTML = original;
            }
        });

        const deleteEvent = async (id) => {
            try {
                await deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'events', id));
                showToast("Activiteit verwijderd", "info");
            } catch (error) {
                showToast("Fout bij verwijderen", "error");
            }
        }

        // --- UI HELPERS ---
        const handleTypeChange = (val) => {
            const endContainer = document.getElementById('endContainer');
            const titleContainer = document.getElementById('titleContainer');
            const titleInput = document.getElementById('evtTitle');

            if(val === 'weekend') { endContainer.classList.remove('hidden'); } 
            else { endContainer.classList.add('hidden'); }

            if(val === 'chirozondag') {
                titleContainer.classList.add('hidden');
                titleInput.removeAttribute('required');
                titleInput.value = 'Chirozondag'; 
            } else {
                titleContainer.classList.remove('hidden');
                titleInput.setAttribute('required', 'true');
                if(titleInput.value === 'Chirozondag') titleInput.value = '';
            }
        };

        document.getElementById('evtType').addEventListener('change', (e) => handleTypeChange(e.target.value));

        const toggleModal = (id, show) => {
            const el = document.getElementById(id);
            if(show) { el.classList.remove('hidden'); el.classList.add('flex'); } 
            else { el.classList.add('hidden'); el.classList.remove('flex'); }
        };

        window.openAddModal = (preselectedDate = null) => {
            document.getElementById('modalTitle').innerText = "Nieuwe Activiteit";
            document.getElementById('addEventForm').reset();
            document.getElementById('evtId').value = "";
            
            if(preselectedDate) {
                document.getElementById('evtStart').value = preselectedDate;
                document.getElementById('evtEnd').value = preselectedDate;
            } else {
                document.getElementById('evtStart').valueAsDate = new Date();
            }
            
            document.getElementById('evtType').value = 'chirozondag';
            handleTypeChange('chirozondag'); 
            toggleModal('addModal', true);
        };

        window.openEditModal = (data) => {
            document.getElementById('modalTitle').innerText = "Activiteit Bewerken";
            document.getElementById('evtId').value = data.id;
            document.getElementById('evtTitle').value = data.title;
            document.getElementById('evtType').value = data.type;
            document.getElementById('evtStart').value = data.start;
            document.getElementById('evtEnd').value = data.end;
            document.getElementById('evtDesc').value = data.description || "";

            handleTypeChange(data.type);
            toggleModal('addModal', true);
        };

        window.closeAddModal = () => toggleModal('addModal', false);
        window.openLoginModal = () => toggleModal('loginModal', true);
        window.closeLoginModal = () => toggleModal('loginModal', false);
        window.closeViewModal = () => toggleModal('viewModal', false);

        window.openViewModal = (evt) => {
            document.getElementById('viewTitle').innerText = evt.title;
            document.getElementById('viewDesc').innerText = evt.description || "Geen extra informatie beschikbaar.";
            
            const startD = new Date(evt.start);
            const endD = new Date(evt.end);
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            
            let dateText = startD.toLocaleDateString('nl-BE', options);
            let durText = "Hele dag";

            if (evt.type === 'chirozondag') durText = "14:00 - 18:00";
            else if (evt.start !== evt.end) durText = `Tot ${endD.toLocaleDateString('nl-BE', options)}`;

            document.getElementById('viewDate').innerText = dateText;
            document.getElementById('viewDuration').innerText = durText;

            const styles = {
                'chirozondag': { icon: 'fa-users', color: 'text-red-600', bg: 'bg-red-50', label: 'Chirozondag' },
                'lk': { icon: 'fa-clipboard-list', color: 'text-blue-600', bg: 'bg-blue-50', label: 'Leidingskring' },
                'activiteit': { icon: 'fa-star', color: 'text-green-600', bg: 'bg-green-50', label: 'Activiteit' },
                'vergadering': { icon: 'fa-comments', color: 'text-amber-600', bg: 'bg-amber-50', label: 'Vergadering' },
                'weekend': { icon: 'fa-campground', color: 'text-purple-600', bg: 'bg-purple-50', label: 'Weekend / Kamp' }
            }[evt.type] || { icon: 'fa-calendar', color: 'text-blue-600', bg: 'bg-blue-50', label: 'Activiteit' };

            const iconDiv = document.getElementById('viewIcon');
            iconDiv.className = `w-14 h-14 rounded-2xl flex items-center justify-center text-2xl shadow-sm shrink-0 ${styles.bg} ${styles.color}`;
            iconDiv.innerHTML = `<i class="fa-solid ${styles.icon}"></i>`;
            document.getElementById('viewType').innerText = styles.label;

            const actions = document.getElementById('viewAdminActions');
            actions.classList.remove('hidden'); actions.classList.add('grid');
            
            document.getElementById('viewDeleteBtn').onclick = () => handleDeleteClick(evt);
            document.getElementById('viewEditBtn').onclick = () => handleEditClick(evt);

            toggleModal('viewModal', true);
        };

        window.onclick = (e) => {
            if(e.target.id === 'addModal') closeAddModal();
            if(e.target.id === 'loginModal') closeLoginModal();
            if(e.target.id === 'viewModal') closeViewModal();
            if(e.target.id === 'bulkModal') closeBulkModal();
            if(e.target.id === 'confirmModal') document.getElementById('cancelDelete').click();
        }

        window.changeMonth = (delta) => {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        };

        window.goToToday = () => {
            currentDate = new Date();
            renderCalendar();
        };

        const renderCalendar = () => {
            const grid = document.getElementById('calendarGrid');
            const label = document.getElementById('currentMonthYear');
            grid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            label.innerText = new Date(year, month).toLocaleDateString('nl-BE', { month: 'long', year: 'numeric' });

            const firstDayIndex = new Date(year, month, 1).getDay();
            const startingDay = firstDayIndex === 0 ? 6 : firstDayIndex - 1;
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < startingDay; i++) {
                const cell = document.createElement('div');
                cell.className = "bg-gray-50 dark:bg-gray-700/30 min-h-[80px] md:min-h-[120px]";
                grid.appendChild(cell);
            }

            const today = new Date();

            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = "day-cell bg-white dark:bg-gray-800 p-1 sm:p-2 flex flex-col gap-1 relative group overflow-y-auto cursor-pointer hover:bg-blue-50/50 dark:hover:bg-gray-700/50 transition-colors min-h-[80px] md:min-h-[120px]";
                
                const dayStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                cell.onclick = () => handleDateClick(dayStr);

                const dateWrapper = document.createElement('div');
                dateWrapper.className = "flex justify-between items-start sticky top-0 bg-inherit z-10 pb-1 pointer-events-none";
                
                const dateNum = document.createElement('span');
                dateNum.className = "text-xs sm:text-sm font-semibold text-gray-400 dark:text-gray-500 w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded-full transition-all";
                dateNum.innerText = day;

                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dateNum.className = "text-xs sm:text-sm font-bold text-white bg-chiro-blue w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center rounded-full shadow-md";
                    cell.classList.add("bg-blue-50", "dark:bg-blue-900/20");
                }

                dateWrapper.appendChild(dateNum);
                cell.appendChild(dateWrapper);

                const dayEvents = events.filter(e => dayStr >= e.start && dayStr <= e.end).sort((a,b) => a.start.localeCompare(b.start));

                dayEvents.forEach(evt => {
                    const pill = document.createElement('div');
                    pill.className = `event-pill type-${evt.type}`;
                    let icon = 'fa-circle';
                    if(evt.type === 'chirozondag') icon = 'fa-user-group';
                    if(evt.type === 'weekend') icon = 'fa-campground';
                    
                    let descHtml = '';
                    if(evt.description && evt.description.trim() !== '') {
                        descHtml = `<div class="text-[8px] font-normal opacity-80 truncate w-full pl-3 mt-0.5 leading-tight">${evt.description}</div>`;
                    }

                    pill.innerHTML = `
                        <div class="flex items-center gap-1 w-full overflow-hidden">
                            <i class="fa-solid ${icon} text-[9px] opacity-70 flex-shrink-0"></i>
                            <span class="truncate leading-tight">${evt.title}</span>
                        </div>
                        ${descHtml}
                    `;
                    pill.title = evt.description ? `${evt.title}\n\n${evt.description}` : evt.title;
                    
                    pill.onclick = (e) => { e.stopPropagation(); openViewModal(evt); };
                    cell.appendChild(pill);
                });
                grid.appendChild(cell);
            }
            lucide.createIcons();
        };

        loadEvents();
    </script>
</body>
</html>